---
title: "Using JavaScript Widgets"
author: "D. Kaplan"
date: "1/15/2019"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dygraphs)
library(plotly)
```

This is an example of how a reader can interact with an HTML document generated by R Markdown. The prime characteristic of such a document is that it is **static**: there is no communication needed with your outside server to animate the document.

A nice list, with examples, is available here: <http://www.htmlwidgets.org/showcase_leaflet.html>

## Annotated, browsable graphs with Plotly

The dataset `ggplot2::economics` is from the Federal Reserve Bank of St. Louis and describes the US population and basic economic measures.

It includes variables

* `date`
* `psavert` personal  savings rate
* `pce` personal consumption expenditures (in  billions of dollars)
* `pop` population (in thousands)
* `unempoy` unemployment (in thousands)
* `uempmed` median duration  of unemployment (weeks)

```{r  plotly}
plot_ly(economics, x = ~date, y = ~ psavert)
```

You might prefer to use plotly with `ggplot2` graphics.

Limited interactivity: you can browse the data, but  you can't change the variables being displayed. 

```{r ggplotly}
My_plot <- ggplot(data = diamonds %>% sample_n(size = 1000), 
                  aes(y = price, x = carat, color = cut)) +
  geom_point(alpha = 0.1)  +
  guides(color = guide_legend(override.aes = list(alpha = 1)))
ggplotly(My_plot)
```

## Browsing time series

This example takes a pat time series: `datasets::UKLungDeaths` giving the number  of monthly deaths from lung diseases in the UK. The plot  will include

* the actual time series
* predictions from a Holt-Winters predictive model.

```{r}
hw <- HoltWinters(ldeaths, seasonal = "multiplicative")
p <- predict(hw, n.ahead = 36, prediction.interval = TRUE, level = 0.95)
ts <- cbind(ldeaths, p)
dygraph(ts, "Deaths from Lung Disease (UK)") %>%
  dySeries("ldeaths", label = "Deaths") %>%
  dySeries(c("p.lwr", "p.fit", "p.upr"), label = "Predicted") %>%
  dyRangeSelector(height = 20)
```

## Networks

```{r networks}
library(visNetwork)
nodes <- data.frame(id = 1:6, title = paste("node", 1:6), 
                    shape = c("dot", "square"),
                    size = 10:15, color = c("blue", "red"))
edges <- data.frame(from = 1:5, to = c(5, 4, 6, 3, 3))
visNetwork(nodes, edges) %>%
  visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE)
```

## Systems using external servers

Some widgets involve existing external servers that you do not need to create or maintain.

### Maps with `leaflet`

The interactivity is limited to manipulating the map.  There can be no feedback from the map to your document.

```{r leaflet}
library(leaflet)

m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=174.768, lat=-36.852, popup="The birthplace of R")
m  # Print the map
```

### Embedding shiny apps

This one won't work from the command line. And you'll need to view the document in a full-featured browser (e.g. Chrome) rather than the RStudio Viewer.

```{r shinyapp}
knitr::include_url("https://dtkaplan.shinyapps.io/Jitter_app/", height  = "800px")
```

If you are compiling this to a non-HTML format (e.g. PDF, Word) it's unlikely that the app  will have the time to  deploy to a meaningful state. Instead, use `webshot::webshot()`
